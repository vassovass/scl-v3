# MCP Configuration Guide

> **Universal MCP (Model Context Protocol) configuration for AI coding assistants.**
> Single source of truth with automatic config generation.

---

## Architecture

```
.agent/
├── mcp.json              # ← UNIVERSAL SOURCE (edit this)
├── SKILLS.md             # Skills manifest
├── MCP.md                # This documentation
└── skills/mcp/           # Individual MCP skill docs
    └── supabase.md

Generated by `npm run mcp:sync`:
├── .mcp.json             # Claude Code
├── .cursor/mcp.json      # Cursor
└── (Antigravity requires manual setup in user home)
```

---

## Quick Start

```bash
# Generate all tool configs from universal source
npm run mcp:sync
```

This reads `.agent/mcp.json` and generates configs for each supported tool.

---

## Active Servers

| Server | Purpose | Connection | Status |
|--------|---------|------------|--------|
| **Supabase** | PostgreSQL database | URL (OAuth) or Postgres | ✅ Active |

### Supabase Capabilities

| Capability | Example Use |
|------------|-------------|
| `query` | "Show me all users with >10k steps" |
| `schema` | "What columns does the feedback table have?" |
| `tables` | "List all tables in the database" |
| `rls` | "Show RLS policies on submissions" |

---

## Tool-Specific Setup

### Claude Code & Cursor (Auto-generated)

Run `npm run mcp:sync` - configs are created automatically.

| Tool | Config Location | Connection Type |
|------|-----------------|-----------------|
| Claude Code | `.mcp.json` | URL (OAuth) |
| Cursor | `.cursor/mcp.json` | URL (OAuth) |

**First-time OAuth:**
1. Use the MCP (e.g., "List tables in supabase")
2. Browser opens for Supabase login
3. Authorize the connection
4. Done - credentials cached

### Antigravity (Manual Setup Required)

Antigravity **only supports stdio (command-based) MCPs**, not HTTP URLs.
Config must be in **user home directory**, not project folder.

**Step 1:** Create config file:
```
Windows: C:\Users\YOUR_NAME\.gemini\antigravity\mcp_config.json
Mac/Linux: ~/.gemini/antigravity/mcp_config.json
```

**Step 2:** Add this content:
```json
{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-postgres",
        "postgresql://postgres:YOUR_PASSWORD@db.nwhvkhydryulgxobqioi.supabase.co:5432/postgres"]
    }
  }
}
```

**Step 3:** Replace `YOUR_PASSWORD` with your Supabase database password.

**Step 4:** Restart Antigravity.

---

## Adding New MCP Servers

### Step 1: Add to Universal Config

Edit `.agent/mcp.json`:

```json
{
  "servers": {
    "my_server": {
      "name": "My Server",
      "description": "What it does",
      "skill": "skills/mcp/my_server.md",
      "status": "active",
      "capabilities": ["cap1", "cap2"],
      "connections": {
        "url": {
          "type": "http",
          "url": "https://example.com/mcp",
          "supports": ["claude-code", "cursor"]
        },
        "stdio": {
          "type": "stdio",
          "command": "npx",
          "args": ["-y", "package-name"],
          "supports": ["antigravity", "claude-code", "cursor"]
        }
      }
    }
  }
}
```

### Step 2: Create Skill Documentation

Create `.agent/skills/mcp/my_server.md` documenting capabilities and usage.

### Step 3: Regenerate Configs

```bash
npm run mcp:sync
```

### Step 4: Update Tool Preferences (optional)

In `.agent/mcp.json` under `tools`, set which connection each tool prefers.

---

## Verification

### Claude Code
```
List the tables in the supabase database
```

### Cursor
```
Use supabase MCP to show the submissions table schema
```

### Antigravity
```
Use list_resources tool for supabase
```

---

## Troubleshooting

| Issue | Tool | Solution |
|-------|------|----------|
| "server not found" | Antigravity | Config must be in `~/.gemini/antigravity/`, not project folder |
| "server not found" | Claude/Cursor | Run `npm run mcp:sync` and restart |
| "unauthorized" | Claude/Cursor | Complete OAuth flow in browser |
| "password authentication failed" | Antigravity | Check password in connection string |
| "connection refused" | All | Verify Supabase project is active |

---

## Security Guidelines

| Rule | Rationale |
|------|-----------|
| ✅ Use URL method when possible | OAuth-based, no local credentials |
| ✅ Use env vars for passwords | Never commit secrets |
| ✅ Read-only by default | Prevent accidental data changes |
| ❌ Never commit mcp_config.json with passwords | Security risk |

---

## Related Files

| File | Purpose |
|------|---------|
| `.agent/mcp.json` | Universal MCP configuration |
| `.agent/SKILLS.md` | Skills manifest |
| `.agent/skills/mcp/` | Individual MCP skill docs |
| `scripts/sync-mcp.js` | Config generator |

---

## Changelog

| Date | Change |
|------|--------|
| 2026-01-12 | Complete rewrite with modular architecture |
| 2026-01-12 | Added `npm run mcp:sync` build script |
| 2026-01-12 | Fixed Antigravity docs (requires stdio, user home) |
| 2026-01-12 | Initial creation |
